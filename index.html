<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>
    
    <!-- Google AdSense Auto ads Code -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7198704920134124"
     crossorigin="anonymous"></script>
    
    <!-- Add Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Remove these ad space styles */
        .game-wrapper,
        .ad-space,
        .ad-space p,
        .ad-space a {
            /* Delete these style blocks */
        }

        /* Keep the game container centered */
        .game-container {
            display: flex;
            justify-content: center;
            align-items: start;
            gap: 20px;
            padding-top: 20vh;
            padding-left: 20px;
            padding-right: 20px;
        }
        canvas {
            border: 4px solid #fff;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5),
                        0 0 40px rgba(255, 105, 180, 0.3);
        }
        .high-scores {
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            border: 4px solid #fff;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.3);
            font-family: 'Press Start 2P', cursive;
            color: #fff;
        }
        .high-scores h2 {
            margin-top: 0;
            color: #ff69b4;
            text-shadow: 2px 2px 0px #000;
            font-size: 16px;
            text-align: center;
            margin-bottom: 20px;
        }
        .score-list {
            list-style: none;
            padding: 0;
        }
        .score-list li {
            padding: 8px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            color: #fff;
            text-shadow: 1px 1px 0px #000;
        }
        body {
            background-color: #2c0138;  /* Dark purple background */
            margin: 0;
            font-family: 'Press Start 2P', cursive;
            background-image: 
                linear-gradient(45deg, #3c015c 25%, transparent 25%),
                linear-gradient(-45deg, #3c015c 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #3c015c 75%),
                linear-gradient(-45deg, transparent 75%, #3c015c 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        /* Add this new style for the nyan cat image */
        #nyanCat {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        #backgroundImage {
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        /* Add retro font styling */
        .game-text {
            font-family: 'Press Start 2P', cursive;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
        }
        /* Keep high scores in regular font */
        .high-scores {
            font-family: Arial, sans-serif;
        }
        /* Add these new styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            border: 4px solid #ff69b4;
            text-align: center;
            z-index: 1001;
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
        }

        .modal h2 {
            font-family: 'Press Start 2P', cursive;
            color: #ff69b4;
            font-size: 18px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px #000;
        }

        .modal input {
            font-family: 'Press Start 2P', cursive;
            padding: 10px;
            margin: 10px 0;
            width: 200px;
            text-align: center;
            border: 2px solid #ff69b4;
            background: #000;
            color: #fff;
            text-shadow: 1px 1px 0px #000;
        }

        .modal button {
            font-family: 'Press Start 2P', cursive;
            padding: 10px 20px;
            margin: 10px;
            background: #ff69b4;
            border: 2px solid #fff;
            color: white;
            cursor: pointer;
            text-shadow: 1px 1px 0px #000;
            transition: all 0.2s ease;
        }

        .modal button:hover {
            background: #ff8cc6;
            transform: scale(1.05);
        }

        .modal button.cancel {
            background: #6a0dad;
        }
        
        .modal button.cancel:hover {
            background: #8b1bd4;
        }
    </style>
</head>
<body>
    <!-- Update background image source to the new static image -->
    <img id="backgroundImage" src="Elements/NEW BG.png" style="display: none;">
    <img id="nyanCat" src="Elements/Frappy.png" style="display: none;">
    
    <!-- Audio elements -->
    <audio id="scoreSound" src="Soundeffect/scores.mp3"></audio>
    <audio id="gameOverSound" src="Soundeffect/Game over.mp3"></audio>
    <audio id="highScoreSound" src="Soundeffect/Highscores.mp3"></audio>

    <!-- Remove game-wrapper and ad spaces, keep only game container -->
    <div class="game-container">
        <canvas id="gameCanvas" width="320" height="480"></canvas>
        <div class="high-scores">
            <h2>Top 5 High Scores</h2>
            <ul id="scoreList" class="score-list">
                <!-- High scores will be inserted here -->
            </ul>
        </div>
    </div>

    <!-- Add this HTML for the modal -->
    <div class="modal-overlay">
        <div class="modal">
            <h2>BOO!! NEW HIGHSCORE!!</h2>
            <input type="text" id="playerNameInput" placeholder="Enter your name" maxlength="10">
            <div>
                <button onclick="submitScore()">Submit</button>
                <button class="cancel" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Replace with the original initialization
        let highScores = JSON.parse(localStorage.getItem('flappyHighScores')) || [];
        
        // Add background image reference
        const backgroundImage = document.getElementById('backgroundImage');
        const birdImage = document.getElementById('nyanCat');
        
        // Remove the onload handler since we're using an img element
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreList = document.getElementById('scoreList');

        // Sound elements
        const scoreSound = document.getElementById('scoreSound');
        const gameOverSound = document.getElementById('gameOverSound');
        const highScoreSound = document.getElementById('highScoreSound');
        let isSoundOn = true;

        // Update bird properties
        const bird = {
            x: 50,
            y: 200,
            velocity: 0,
            gravity: 0.5,
            jump: -8,
            width: 40,
            height: 40
        };

        // Pipe properties
        const pipes = [];
        const PIPE_WIDTH = 50;
        const PIPE_GAP = 150;
        const PIPE_SPEED = 2;

        let gameStarted = false;  // New variable to track if game has started
        let gameOver = false;
        let score = 0;

        // Add this after the other constant declarations
        const sparkles = [];  // Array to store sparkle particles

        // Add sparkle class
        class Sparkle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 3 + 2;
                this.opacity = 1;
                this.color = this.getRandomColor();
            }

            getRandomColor() {
                const colors = ['#fff', '#ff0', '#f0f', '#0ff']; // White, yellow, pink, cyan
                return colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.opacity -= 0.02;  // Fade out
                this.x -= PIPE_SPEED;  // Move with the game speed
                this.y += (Math.random() - 0.5) * 2;  // Slight random vertical movement
            }

            draw(ctx) {
                ctx.save();
                ctx.fillStyle = this.color;
                ctx.globalAlpha = this.opacity;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }

        function playSound(sound) {
            if (isSoundOn) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log("Sound play failed:", e));
            }
        }

        function updateHighScores(newScore) {
            if (newScore > 0 && isHighScore(newScore)) {
                playSound(highScoreSound);
                showHighScoreModal(newScore);
            }
        }

        function isHighScore(score) {
            if (score <= 0) return false;
            
            return highScores.length < 5 || score > highScores[highScores.length - 1].score;
        }

        function displayHighScores() {
            scoreList.innerHTML = highScores
                .map((score, index) => `
                    <li>${index + 1}. ${score.name}: ${score.score}</li>
                `)
                .join('');
        }

        function resetGame() {
            bird.y = 200;
            bird.velocity = 0;
            pipes.length = 0;
            score = 0;
            gameOver = false;
            sparkles.length = 0;  // Clear sparkles
            update();
        }

        // Update the keydown event listener
        document.addEventListener('keydown', function(e) {
            if (modalOverlay.style.display === 'block') {
                if (e.key === 'Escape') {
                    closeModal();
                }
                return;
            }

            if (e.code === 'Space') {
                if (!gameStarted) {
                    // Start the game
                    gameStarted = true;
                    resetGame();
                } else if (gameOver) {
                    resetGame();
                } else {
                    bird.velocity = bird.jump;
                }
                e.preventDefault();
            } else if (e.code === 'KeyM') {
                isSoundOn = !isSoundOn;
            }
        });

        function createPipe() {
            const gapPosition = Math.random() * (canvas.height - PIPE_GAP);
            pipes.push({
                x: canvas.width,
                topHeight: gapPosition,
                bottomY: gapPosition + PIPE_GAP
            });
        }

        function update() {
            if (!gameStarted) return;  // Don't update if game hasn't started
            if (gameOver) return;

            bird.velocity += bird.gravity;
            bird.y += bird.velocity;

            if (pipes.length === 0 || pipes[pipes.length - 1].x < canvas.width - 200) {
                createPipe();
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= PIPE_SPEED;

                if (bird.x + bird.width > pipes[i].x && 
                    bird.x < pipes[i].x + PIPE_WIDTH &&
                    (bird.y < pipes[i].topHeight || 
                     bird.y + bird.height > pipes[i].bottomY)) {
                    gameOver = true;
                    playSound(gameOverSound);
                    updateHighScores(score);
                }

                if (pipes[i].x + PIPE_WIDTH < 0) {
                    pipes.splice(i, 1);
                    score++;
                    playSound(scoreSound);
                }
            }

            if (bird.y < 0 || bird.y + bird.height > canvas.height) {
                gameOver = true;
                playSound(gameOverSound);
                updateHighScores(score);
            }

            // Create new sparkles at Nyan Cat's position
            if (!gameOver) {
                sparkles.push(new Sparkle(
                    bird.x,
                    bird.y + bird.height/2
                ));
            }

            // Update and draw sparkles
            for (let i = sparkles.length - 1; i >= 0; i--) {
                sparkles[i].update();
                sparkles[i].draw(ctx);
                
                // Remove faded sparkles
                if (sparkles[i].opacity <= 0) {
                    sparkles.splice(i, 1);
                }
            }

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            // Draw background
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);

            if (!gameStarted) {
                // Draw start screen with enhanced styling
                // Title shadow effect
                ctx.fillStyle = '#000';
                ctx.font = '32px "Press Start 2P"';
                for(let i = 4; i >= 0; i--) {
                    ctx.fillText('FRAPPY', canvas.width/2 - 80 + i, canvas.height/2 - 60 + i);
                }
                
                // Title main color
                ctx.fillStyle = '#fff';  // Changed from pink to white for ghost theme
                ctx.fillText('FRAPPY', canvas.width/2 - 80, canvas.height/2 - 60);

                // Flashing effect for "Press SPACE"
                const flashingRate = Math.sin(Date.now() * 0.005) * 0.5 + 0.5;
                ctx.fillStyle = `rgba(255, 255, 255, ${flashingRate})`;
                
                // Instructions with shadow
                ctx.font = '20px "Press Start 2P"';
                ctx.fillStyle = '#000';
                ctx.fillText('Press SPACE', canvas.width/2 - 90 + 2, canvas.height/2 + 20 + 2);
                ctx.fillText('to begin!', canvas.width/2 - 70 + 2, canvas.height/2 + 50 + 2);
                
                ctx.fillStyle = '#fff';
                ctx.fillText('Press SPACE', canvas.width/2 - 90, canvas.height/2 + 20);
                ctx.fillText('to begin!', canvas.width/2 - 70, canvas.height/2 + 50);
                
                // Draw nyan cat in center with slight bounce
                const bounce = Math.sin(Date.now() * 0.003) * 5;
                ctx.drawImage(birdImage, 
                    canvas.width/2 - bird.width/2,
                    canvas.height/2 - 120 + bounce,
                    bird.width,
                    bird.height
                );
            } else {
                // Draw regular game elements
                ctx.drawImage(birdImage, bird.x, bird.y, bird.width, bird.height);

                // Draw pipes
                pipes.forEach(pipe => {
                    // Colors for the pipe
                    const mainColor = '#45883f';     // Darker green
                    const highlightColor = '#6bc05c'; // Lighter green
                    const shadowColor = '#346b2f';    // Darkest green
                    
                    // Function to draw a pipe section
                    function drawPipeSection(x, y, height, isTop) {
                        // Main pipe body
                        ctx.fillStyle = mainColor;
                        ctx.fillRect(x, y, PIPE_WIDTH, height);
                        
                        // Pipe head (larger section at end)
                        const headHeight = 30;
                        const headWidth = 60;
                        const headX = x - (headWidth - PIPE_WIDTH) / 2;
                        const headY = isTop ? height - headHeight + y : y;
                        
                        // Main head section
                        ctx.fillStyle = mainColor;
                        ctx.fillRect(headX, headY, headWidth, headHeight);
                        
                        // Highlight
                        ctx.fillStyle = highlightColor;
                        ctx.fillRect(headX + 2, headY + (isTop ? 2 : 0), 3, headHeight - 2);
                        ctx.fillRect(x + 2, y + (isTop ? 0 : 2), 3, height - 2);
                        
                        // Shadow
                        ctx.fillStyle = shadowColor;
                        ctx.fillRect(headX + headWidth - 5, headY + 2, 3, headHeight - 2);
                        ctx.fillRect(x + PIPE_WIDTH - 5, y + 2, 3, height - 2);
                    }

                    // Draw top pipe
                    drawPipeSection(pipe.x, 0, pipe.topHeight, true);
                    
                    // Draw bottom pipe
                    drawPipeSection(pipe.x, pipe.bottomY, canvas.height - pipe.bottomY, false);
                });

                // Draw score and sound status
                ctx.fillStyle = 'white';
                ctx.font = '16px "Press Start 2P"';
                ctx.fillText(`Score: ${score}`, 10, 30);
                ctx.font = '12px "Press Start 2P"';
                ctx.fillText(`Sound: ${isSoundOn ? 'ON' : 'OFF'} (Press M)`, 10, canvas.height - 10);

                if (gameOver) {
                    ctx.fillStyle = 'white';
                    ctx.font = '24px "Press Start 2P"';
                    ctx.fillText('Game Over!', canvas.width/2 - 100, canvas.height/2);
                    ctx.font = '12px "Press Start 2P"';
                    ctx.fillText('Press SPACE to restart', canvas.width/2 - 120, canvas.height/2 + 40);
                }
            }
        }

        // Start the game loop but don't start the game
        displayHighScores();
        update();
        requestAnimationFrame(draw);  // Keep drawing even when game hasn't started

        // Add these functions
        const modalOverlay = document.querySelector('.modal-overlay');
        const playerNameInput = document.getElementById('playerNameInput');
        let pendingScore = 0;

        function showHighScoreModal(score) {
            pendingScore = score;
            modalOverlay.style.display = 'block';
            playerNameInput.value = '';
            playerNameInput.focus();
        }

        function submitScore() {
            const playerName = playerNameInput.value.trim();
            if (playerName) {
                highScores.push({ name: playerName, score: pendingScore });
                highScores.sort((a, b) => b.score - a.score);
                highScores = highScores.slice(0, 5);
                localStorage.setItem('flappyHighScores', JSON.stringify(highScores));
                displayHighScores();
                modalOverlay.style.display = 'none';
            }
        }

        // Add event listener for Enter key
        playerNameInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                submitScore();
            }
        });

        // Add close modal function
        function closeModal() {
            modalOverlay.style.display = 'none';
        }

        // Add click outside to close
        modalOverlay.addEventListener('click', function(event) {
            if (event.target === modalOverlay) {
                closeModal();
            }
        });
    </script>
</body>
</html>
